// functions/index.js

const functions = require("firebase-functions");
const nodemailer = require("nodemailer");

// Gmail hisobingiz ma'lumotlari
const gmailEmail = "sizning_emailingiz@gmail.com";
const gmailPassword = "sizning_parolingiz"; // Yoki ilova paroli

const mailTransport = nodemailer.createTransport({
  service: "gmail",
  auth: {
    user: gmailEmail,
    pass: gmailPassword,
  },
});

exports.sendVerificationEmail = functions.https.onCall(async (data, context) => {
  const userEmail = data.email;
  const verificationCode = data.code;

  const mailOptions = {
    from: '"Soundora Films" <sizning_emailingiz@gmail.com>',
    to: userEmail,
    subject: `Soundora Films - Tasdiqlash kodingiz`,
    text: `Soundora Films ilovasiga xush kelibsiz! Sizning tasdiqlash kodingiz: ${verificationCode}`,
    html: `<p>Soundora Films ilovasiga xush kelibsiz!</p><p>Sizning tasdiqlash kodingiz: <strong>${verificationCode}</strong></p>`,
  };

  try {
    await mailTransport.sendMail(mailOptions);
    console.log(`Verification code sent to: ${userEmail}`);
    return { success: true };
  } catch (error) {
    console.error("There was an error while sending the email:", error);
    return { success: false, error: error.message };
  }
});